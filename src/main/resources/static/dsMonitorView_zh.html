<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="html">
<head>
    <meta charset='utf-8'>
    <title>小蜜蜂连接池监控</title>
    <style type="text/css">
        table
        {
            border-collapse: collapse;
            margin: 0 auto;
            text-align: center;
        }
        table td, table th
        {
            border: 1px solid #cad9ea;
            color: #666;
            height: 30px;
        }
        table tr th
        {
            background-color: #CCE8EB;
            width: 100px;
        }
        table tr:nth-child(odd)
        {
            background: #fff;
        }
        table tr:nth-child(even)
        {
            background: #F5FAFA;
        }
    </style>
</head>
<body>
<script src="jquery.min.js"></script>
<script>
    $(function(){
        var reqURL=getContextPath()+'/dsMonitor/getJson';
        $("#refresh").click(function(){
            $.ajax({
                type: 'GET',
                url: reqURL,
                dataType: 'json',
                success: function(data){
                    console.info(data);
                    $("#monitorTable tr:not(:first)").empty();
                    if(data){
                        $.each(data, function(i, element){
                            var mode=(element.poolMode=='compete')?'竞争':'公平';
                            var state;
                            if(element.poolState==1)
                                state="未初始化";
                            else if(element.poolState==2)
                                state="已启动";
                            else if(element.poolState==3)
                                state="已关闭";
                            else if(element.poolState==4)
                                state="重置中";

                            var tableHtml = "<tr>" +
                                "<td>" + element.poolName + "</td>" +
                                "<td>" + mode+ "</td>" +
                                "<td>" + state + "</td>" +
                                "<td>" + element.maxActive + "</td>" +
                                "<td>" + element.idleSize + "</td>" +
                                "<td>" + element.usingSize + "</td>" +
                                "<td>" + element.semaphoreWaiterSize + "</td>" +
                                "<td>" + element.transferWaiterSize + "</td>" +
                                "</tr>";
                            $("#monitorTable").append(tableHtml);
                        });
                    }
                }
            });
        });

        function getContextPath() {
            var webFullPath=window.document.location.href;
            var strPath=window.document.location.pathname;
            var pos=webFullPath.indexOf(strPath);
            var webHostPath=webFullPath.substring(0,pos);
            var projectName=strPath.substring(0,strPath.substr(1).indexOf("/")+1);
            return(webHostPath+projectName);
        }

        $("#refresh").trigger("click");
    });
</script>
<table id="monitorTable"  class="table table-hover">
    <tr class="table-header">
        <th>池名称</th>
        <th>池模式</th>
        <th>池状态</th>
        <th>最大连接</th>
        <th>闲置连接</th>
        <th>使用中连接</th>
        <th>信号等待数</th>
        <th>传递等待数</th>
    </tr>
</table>
<p></p>
<div align="center"><input type="button"  id="refresh" valign="center" value="刷 新"/></div>
</body>
</html>
