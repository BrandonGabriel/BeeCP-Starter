<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>BeeCP Monitor</title>
    <link href="js/BeeCPMonitorView.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- tab栏 -->
<ul id="tabs">
    <li class="current"><a href="#" rel="external nofollow" title="tab1">Pool List</a></li>
    <li><a href="#" rel="external nofollow" title="tab2">SQL Execution</a></li>
</ul>
<!-- 对应显示内容 -->
<div id="content">
    <div class="item show" id="tab1">
        <table id="pool-monitorTable">
            <thead>
            <tr>
                <th>Pool Name</th>
                <th>Pool Mode</th>
                <th>Pool State</th>
                <th>Max Active</th>
                <th>Idle Size</th>
                <th>Using Size</th>
                <th>Semaphore Waiter Size</th>
                <th>Transfer Waiter Size</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <p></p>
        <div align="center">
            <input id="pool_Refresh" type="button" valign="center" value="Refresh"/>
            <p></p>
        </div>
    </div>
    <div class="item" id="tab2">
        <table id="sql-monitorTable">
            <thead>
            <tr>
                <th>SQL</th>
                <th>Pool Name</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Took Time(Ms)</th>
                <th>Sucessful</th>
                <th>Method</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <p></p>
        <div align="center">
            <input id="sql-refresh" type="button" valign="center" value="Refresh"/>
            <p></p>
        </div>
    </div>
</div>
<script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
<script src="js/jquery.tablesort.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        $('table').tablesort().data('tablesort');
        var poolURL = getContextPath() + '/dsMonitor/getPoolList';
        var sqlURL = getContextPath() + '/dsMonitor/getSqTraceList';

        $("#pool_Refresh").click(function () {
            $.ajax({
                type: 'GET',
                url: poolURL,
                dataType: 'json',
                success: function (data) {
                    console.info(data);
                    $("#pool-monitorTable tr:not(:first)").empty();
                    if (data) {
                        $.each(data, function (i, element) {
                            var state;
                            if (element.poolState == 1)
                                state = "Uninitialized";
                            else if (element.poolState == 2)
                                state = "Started";
                            else if (element.poolState == 3)
                                state = "Closed";
                            else if (element.poolState == 4)
                                state = "Reseting";

                            var tableHtml = "<tr>" +
                                "<td>" + element.poolName + "</td>" +
                                "<td>" + element.poolMode + "</td>" +
                                "<td>" + state + "</td>" +
                                "<td>" + element.maxActive + "</td>" +
                                "<td>" + element.idleSize + "</td>" +
                                "<td>" + element.usingSize + "</td>" +
                                "<td>" + element.semaphoreWaiterSize + "</td>" +
                                "<td>" + element.transferWaiterSize + "</td>" +
                                "</tr>";
                            $("#pool-monitorTable").append(tableHtml);
                        });
                    }
                }
            });
        });

        $("#sql-refresh").click(function () {
            $.ajax({
                type: 'GET',
                url: sqlURL,
                dataType: 'json',
                success: function (data) {
                    console.info(data);
                    $("#sql-monitorTable tr:not(:first)").empty();
                    if (data) {
                        $.each(data, function (i, element) {
                            var tableHtml = "<tr>" +
                                "<td>" + element.sql + "</td>" +
                                "<td>" + element.poolName + "</td>" +
                                "<td>" + element.execStartTime + "</td>" +
                                "<td>" + element.execEndTime + "</td>" +
                                "<td>" + element.execTookTimeMs + "</td>" +
                                "<td>" + element.execSuccess + "</td>" +
                                "<td>" + element.statementType + '.' + element.methodName + "</td>" +
                                "</tr>";
                            $("#sql-monitorTable").append(tableHtml);
                        });
                    }
                }
            });
        });

        function getContextPath() {
            var webFullPath = window.document.location.href;
            var strPath = window.document.location.pathname;
            var pos = webFullPath.indexOf(strPath);
            var webHostPath = webFullPath.substring(0, pos);
            var projectName = strPath.substring(0, strPath.substr(1).indexOf("/") + 1);
            return (webHostPath + projectName);
        }

        $("#pool_Refresh").trigger("click");
        $('#tabs a').click(function (e) {
            e.preventDefault();
            $('#tabs li').removeClass("current").removeClass("hoverItem");
            $(this).parent().addClass("current");
            $("#content div").removeClass("show");
            $('#' + $(this).attr('title')).addClass('show');
        });

        $('#tabs a').hover(function () {
            if (!$(this).parent().hasClass("current")) {
                $(this).parent().addClass("hoverItem");
            }
        }, function () {
            $(this).parent().removeClass("hoverItem");
        });
    });
</script>
　　
</body>
</html>